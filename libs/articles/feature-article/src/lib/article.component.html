<div class="article-page">
  <div class="banner">
    <div class="container">
      <h1 data-e2e-id="article-title">{{ (article$ | async).title }}</h1>
      <app-article-meta
        [article]="article$ | async"
        (follow)="facade.follow$.next($event)"
        (unfollow)="facade.unfollow$.next($event)"
        (favorite)="facade.favorite$.next($event)"
        (unfavorite)="facade.unfavorite$.next($event)"
        (delete)="facade.deleteArticle$.next($event)"
        [canModify]="canModify$ | async"
      >
      </app-article-meta>
    </div>
  </div>

  <div class="container page">
    <div class="row article-content">
      <div class="col-md-12">
        <div [innerHTML]="(article$ | async)?.body | markdown"></div>
      </div>
    </div>
    <hr />
    <div class="article-actions">
      <app-article-meta
        [article]="article$ | async"
        (follow)="facade.follow$.next($event)"
        (unfollow)="facade.unfollow$.next($event)"
        (favorite)="facade.favorite$.next($event)"
        (unfavorite)="facade.unfavorite$.next($event)"
        (delete)="facade.deleteArticle$.next($event)"
        [canModify]="canModify$ | async"
      ></app-article-meta>
    </div>

    <div class="row">
      <div class="col-xs-12 col-md-8 offset-md-2" *ngIf="data$ | async as data">
        <app-add-comment
          *ngIf="isAuthenticated$ | async"
          [article]="article$ | async"
          [data$]="data$"
          [structure$]="structure$"
          [currentUser]="currentUser$ | async"
          [touchedForm$]="touched$"
          (submitComment)="facade.addComment$.next({ slug: $event, comment: data.comment })"
          (updateForm)="store.updateData($event)"
        >
        </app-add-comment>

        <div *ngIf="(isAuthenticated$ | async) === false">
          <a [routerLink]="['/login']">Sign in</a> or <a [routerLink]="['/register']">sign up</a> to add comments on
          this article.
        </div>

        <app-article-comment
          *ngFor="let comment of comments$ | async"
          [currentUser]="currentUser$ | async"
          (delete)="facade.deleteComment$.next($event)"
          [article]="article$ | async"
          [comment]="comment"
        ></app-article-comment>
      </div>
    </div>
  </div>
</div>
